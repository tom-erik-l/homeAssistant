homeassistant:
  customize:
    package.node_anchors:
      counters: &counters
        entity_id:
          - counter.stue
          - counter.spisestue
          - counter.kokken
          - counter.sovevaerelse
          - counter.badevaerelselse
          - counter.gang
          - counter.noop

      lights: &lights
        entity_id:
          - light.stue
          - light.spisestue
          - light.kokken
          - light.sovevaerelse
          - light.badevaerelse
          - light.gang

      switches: &switches
        entity_id:
          - switch.circadian_lighting_stue
          - switch.circadian_lighting_spisestue
          - switch.circadian_lighting_kokken
          - switch.circadian_lighting_sovevaerelse
          - switch.circadian_lighting_badevaerelse
          - switch.circadian_lighting_gang

automation:
  - id: hass_startup
    alias: 'Hass startup'
    trigger:
    - platform: homeassistant
      event: start
    action:
    # Ensure that the Circadian Lights are enabled after rebooting HASS
    - service: switch.turn_on
      data: *switches
    # Ensure that all counters are reset after rebooting HASS
    - service: counter.reset
      data: *counters

  - alias: 'resetLightToggleCounter'
    # Reset the counter every 10 seconds
    initial_state: "on"
    trigger:
    - platform: time_pattern
      seconds: /10
    action:
    - service: counter.reset
      data: *counters

  - alias: "incrementCounter"
    # Increment the light counter if a light switches from off to on IF the boolean "disableincrement" == "off"
    initial_state: "on"
    trigger:
    - platform: state
      <<: *lights
      from: "off"
      to: "on"
    condition:
    - condition: state
      entity_id: input_boolean.disableincrement
      state: "off"
    action:
    - service: counter.increment
      data_template:
        entity_id: >
          {% if trigger.entity_id == 'light.stue' %}
            counter.stue
          {% elif trigger.entity_id == 'light.spisestue' %}
            counter.spisestue
          {% elif trigger.entity_id == 'light.badevaerelse' %}
            counter.badevaerelse
          {% elif trigger.entity_id == 'light.gang' %}
            counter.gang
          {% elif trigger.entity_id == 'light.kokken' %}
            counter.kokken
          {% elif trigger.entity_id == 'light.sovevaerelse' %}
            counter.sovevaerelse
          {% else %}
            counter.noop
          {% endif %}

  - alias: "Stue: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_stue
        lights: light.hele_stue

  - alias: "Spisestue: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_spisestue
        lights: light.hele_spisestue

  - alias: "Køkken: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_kokken
        lights: light.hele_kokken

  - alias: "Soveværelse: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_sovevaerelse
        lights: light.hele_sovevaerelse

  - alias: "Badeværelse: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_badevaerelse
        lights: light.hele_badevaerelse

  - alias: "Gang: Toggle Manual Override"
    # Enable manual override of Circadian lights IF counter > 2:
    initial_state: "on"
    use_blueprint:
      path: circadianLightning/toggle.yaml
      input:
        toggles: 2
        disableincrementboolean: input_boolean.disableincrement
        counter: counter.stue
        circardianswitch: switch.circadian_lighting_gang
        lights: light.hele_gang